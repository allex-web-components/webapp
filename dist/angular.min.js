angular.module("allex_applib",[]),function(a,b,c){"use strict";function d(){i.call(this)}function e(a,b,d){Array.prototype.push.apply(a,c.ANGULAR_REQUIREMENTS.get(d))}function f(a,b){for(var d=0;d<a.length;d++)c.ANGULAR_REQUIREMENTS.get(a[d].type)&&!b.get(a[d].type)&&b.add(a[d].type,!0),a[d].options&&a[d].options.elements&&f(a[d].options.elements,b)}var g=a.lib,h=b.registerPreprocessor,i=b.BasicProcessor,j=new g.Map;c.ANGULAR_REQUIREMENTS=j,g.inherit(d,i),d.prototype.destroy=function(){i.prototype.destroy.call(this)},d.prototype.process=function(a){if(a&&a.resources){var b,c=a.resources,d=null,h=0;for(b=0;b<c.length;b++)if("AngularBootstrapper"===c[b].type){if(h>0)throw new Error("Multiple instances of AngularBootstrapper found, only one allowed");d=c[b],h++}d||(d={type:"AngularBootstrapper",name:"AngularBootstrapper",options:{angular_dependencies:[]}},c.push(d)),d.options.angular_dependencies||(d.options.angular_dependencies=[]);var i=new g.Map;f(a.elements,i),i.traverse(e.bind(null,d.options.angular_dependencies)),d.options.angular_dependencies=g.arryOperations.unique(d.options.angular_dependencies)}},h(new d)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_applib,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent),angular.module("allex_applib",[]),function(a,b,c,d){"use strict";function e(a){h.call(this,a),this.raise=null,this._getResource=null}function f(a){e.call(this,a),this.data=null}var g=a.lib,h=g.BasicAngularController;g.inherit(e,h),e.prototype.__cleanUp=function(){this.raise=null,this._getResource=null,h.prototype.__cleanUp.call(this)},e.prototype.getResource=function(a){return this._getResource?this._getResource(a):void 0},e.prototype.elementReady=function(a){var b=a.data("allex_element");if(!b)throw new Error("Missing allex element ...");b.set("$scopectrl",this)},e.prototype.raiseEvent=function(a,b){this.raise(a,b)},g.inherit(f,e),f.prototype.__cleanUp=function(){this.data=null,e.prototype.__cleanUp.call(this)},f.prototype.set_data=function(a){return this.data===a?!1:(this.data=a,!0)},b.elements.AngularDataAwareController=f,b.elements.BasicAngularElementController=e}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular.module("allex_applib")),function(a,b,c,d){"use strict";function e(a,b){g.call(this,a,b),this.$scopectrl=null}var f=a.lib,g=(f.BasicAngularController,b.elements.WebElement);f.q;f.inherit(e,g),e.prototype.__cleanUp=function(){this.$scopectrl=null,g.prototype.__cleanUp.call(this)},e.prototype.set_$scopectrl=function(a){this.$scopectrl=a,this._onScope(a),this._setRaise()},e.prototype._setRaise=function(){this.$scopectrl.set("raise",this._doTrigger.bind(this)),this.$scopectrl.set("_getResource",this.getResource.bind(this))},e.prototype._doTrigger=function(){this.$element.trigger.apply(this.$element,arguments)},e.prototype.getMeAsElement=function(){return this.$element},e.prototype.initialize=function(){g.prototype.initialize.call(this),this.$element.data("allex_element",this)},e.prototype.$apply=function(){this.$scopectrl&&this.$scopectrl.$apply()},e.prototype._onScope=f.dummyFunc,b.elements.BasicAngularElement=e}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular.module("allex_applib")),function(a,b,c,d){"use strict";function e(a,b){k.call(this,a,b),j.call(this)}function f(a,b){k.call(this,a,b)}function g(a){i.call(this,a),this.data=null}var h=a.lib,i=b.elements.AngularDataAwareController,j=b.mixins.DataElementMixIn,k=b.elements.BasicAngularElement;h.q;h.inherit(e,k),e.prototype.__cleanUp=function(){j.prototype.__cleanUp.call(this),k.prototype.__cleanUp.call(this)},e.prototype.initialize=function(){k.prototype.initialize.call(this),this.$element.attr("data-allex-angular-element","")},e.prototype.set_data=function(a){var b=j.prototype.set_data.call(this,a);return j.prototype.hasDataChanged.call(this,b)&&this.$scopectrl.set("data",this.data),b},b.elements.AngularElement=e,c.registerElementType("AngularElement",e),h.inherit(f,k),f.prototype.set_data=function(a){var b,c,d=j.prototype.set_data.call(this,a);return j.prototype.hasDataChanged.call(this,d)&&(b=this.__parent.$scopectrl,c=this.$element.attr("name"),b&&c&&(b.data[c]=a)),d},b.elements.AngularFormElement=f,c.registerElementType("AngularFormElement",f),h.inherit(g,i),g.prototype.__cleanUp=function(){this.data=null,i.prototype.__cleanUp.call(this)},d.controller("allexAngularElementController",["$scope",function(a){new g(a)}]),d.directive("allexAngularElement",[function(){return{restrict:"A",scope:!0,controller:"allexAngularElementController",link:function(a,b,c){a._ctrl.elementReady(b)}}}])}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular.module("allex_applib")),function(a,b,c,d){"use strict";function e(a,b){k.call(this,a,b),this.$form=null,this.submit=new i.HookCollection,this.valid=null,this._valid_l=null,this.validfields={},this._validfields_l={},this._default_values={},this.change=new i.HookCollection,this.initial=b?b.initial:null,this.array_keys=b?b.array_keys:null}function f(a,b,c){c in a||(a[c]=b)}function g(a){j.call(this,a),this.data={},this.valid=!1,this._watcher=null,this.validation=null,this._onChange=null,this.config=null}function h(a){l.call(this,a)}var i=a.lib,j=b.elements.BasicAngularElementController,k=b.elements.BasicAngularElement,l=(i.q,c.BasicModifier),m=/\[\]$/;i.inherit(e,k),e.prototype.__cleanUp=function(){this.array_keys=null,this.initial=null,this.change.destroy(),this.change=null,this._default_values=null,i.traverseShallow(this._validfields_l,this._unlisten.bind(this)),this.validfields=null,this.$form=null,this._valid_l&&this._valid_l.destroy(),this._valid_l=null,this.submit.destroy(),this.submit=null,this.valid=!1,k.prototype.__cleanUp.call(this)},e.prototype._unlisten=function(a){i.isFunction(a)&&a()},e.prototype.set_actual=function(a){k.prototype.set_actual.call(this,a)},e.prototype.initialize=function(){k.prototype.initialize.call(this),this.$element.attr({"data-allex-angular-form-logic":""}),this.$form=this.$element.is("form")?this.$element:this.$element.find("form"),this.$form.attr({name:this.get("id"),novalidate:""}),this.$form.removeAttr("action"),this.$form.find("[name]").toArray().forEach(this._prepareForAngular.bind(this)),this.appendHiddenFields(this.getConfigVal("hidden_fields"))},e.prototype._prepareForAngular=function(a){var b=jQuery(a),c=b.attr("name"),d=this.getModelName(c);b.attr({"data-allex-angular-validate":"_ctrl.validation."+d,"data-ng-change":"_ctrl.onChange('"+d+"', _ctrl.data."+d+")","data-ng-disabled":"false"}),b.attr("data-ng-model")||b.attr("ng-model")||b.attr("data-ng-model","_ctrl.data."+d),this._validfields_l[d]=null},e.prototype.appendHiddenFields=function(a){a&&a.length&&a.forEach(this._appendHiddenField.bind(this))},e.prototype._appendHiddenField=function(a){var b=i.isString(a)?a:a.name,c={name:b,type:"hidden"},d=!i.isString(a);d&&(c.required=a.required?"":void 0,"value"in a&&(this._default_values[b]=a.value)),this.findByFieldName(b).remove();var e=$("<input>").attr(c);this._prepareForAngular(e),this.$form.append(e)},e.prototype.findByFieldName=function(a){return this.$form.find('[name="'+a+'"]')},e.prototype.toArray=function(a){return i.hashToArray(a,this.get("data"))},e.prototype.fireSubmit=function(){this.submit.fire(this.array_keys?this.toArray(this.array_keys):this.$scopectrl.data)},e.prototype.set_data=function(a){i.traverseShallow(this._default_values,f.bind(null,a)),this.$scopectrl.set("data",a)},e.prototype.get_data=function(){return this.$scopectrl?this.$scopectrl.get("data"):null},e.prototype.getModelName=function(a){var b=a;return a.match(m)&&(b=a.replace(m,"")),b},e.prototype._onScope=function(a){this._valid_l=a.attachListener("valid",this.set.bind(this,"valid")),a.set("validation",this.getConfigVal("validation")),a.set("_onChange",this._onChanged.bind(this)),i.traverseShallow(this._validfields_l,this._watchForValid.bind(this,a.scope,this.$form.attr("name"))),a.set("config",this.getConfigVal("form")),this.initial&&i.runNext(this._setInitial.bind(this))},e.prototype._onChanged=function(a,b,c){this.changed.fire("data",a),this.change.fire(b,c)},e.prototype._setInitial=function(a){this.set("data",i.extend({},this.initial,a));for(var b in this.initial)this.change.fire(b,this.initial[b])},e.prototype.resetForm=function(a){this._setInitial(a)},e.prototype._watchForValid=function(a,b,c,d){this._validfields_l[d]=a.$watch("_ctrl.data."+d,this._updateError.bind(this,a,b,d))},e.prototype._updateError=function(a,b,c){var d=i.extend({},this.validfields);return a[b][c]?(d[c]=!Object.keys(a[b][c].$error).length,void this.set("validfields",d)):void console.warn("no "+c+" in validator")},e.prototype.set_valid=function(a){return this.valid===a?!1:(this.valid=a,!0)},e.prototype.empty=function(){this.set("data",{})},e.prototype.setInputEnabled=function(a,b){this.$form.find('[name="'+a+'"]').attr("data-ng-disabled",b?"false":"true"),this.$scopectrl.$apply()},e.prototype.disableInput=function(a){this.setInputEnabled(a,!1)},e.prototype.enableInput=function(a){this.setInputEnabled(a,!0)},b.elements.AngularFormLogic=e,c.registerElementType("AngularFormLogic",e),i.inherit(g,j),g.prototype.__cleanUp=function(){this.validation=null,this._watcher&&this._watcher(),this._watcher=null,this.data=null,this.valid=null,this._onChange=null,this.config=null,j.prototype.__cleanUp.call(this)},g.prototype.onChange=function(a,b){i.isFunction(this._onChange)&&this._onChange(this.data,a,b)},g.prototype.elementReady=function(a){j.prototype.elementReady.call(this,a),this._watcher=this.scope.$watch(a.attr("id")+".$valid",this.set.bind(this,"valid"))},g.prototype.set_valid=function(a){return this.valid===a?!1:(this.valid=a||null,!0)},g.prototype.validate=function(a,b,c){var d=this.validation;return d&&d[a]?this.validateJSON(d[a].json_schema,b)?this.validateFunction(d[a].custom,b):!1:!0},g.prototype.validateJSON=function(a,b){if(!a)return!0;var c=i.jsonschema.validate(b,a);return!c.errors.length},g.prototype.validateFunction=function(a,b){return i.isFunction(a)?a(b,this.data):!0},d.controller("allexAngularFormLogicController",["$scope",function(a){new g(a)}]),d.directive("allexAngularFormLogic",function(){return{restrict:"A",scope:!0,controller:"allexAngularFormLogicController",link:function(a,b,c){a._ctrl.elementReady(b)}}}),i.inherit(h,l),h.prototype.destroy=function(){l.prototype.destroy.call(this)},h.prototype.doProcess=function(a,b,c,d,e){var f=a+"Submit",g="."+f;switch(b.push({name:f,type:"WebElement"}),c.push({source:g+".$element!click",target:".>fireSubmit"}),this.getConfigVal("actualon")){default:case"valid":d.push({triggers:[".:valid, .:actual"],references:g+", .",handler:function(a,b){a.set("actual",b.get("valid")&&b.get("actual"))}})}},h.ALLOWED_ON=["AngularFormLogic"],h.prototype.DEFAULT_CONFIG=function(){return{actualon:"valid"}},c.registerModifier("AngularFormLogic.submit",h)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular.module("allex_applib")),function(a,b,c,d){"use strict";function e(a,b){n.call(this,a,b),m.call(this),this.afterEdit=new k.HookCollection,this.config.grid.data||(this.config.grid.data="_ctrl.data")}function f(a){h("enableCellEdit",a)}function g(a){h("enableColumnResizing",a)}function h(a,b){return b[a]?!0:void 0}function i(a,b){l.call(this,a),o.call(this),this.data=[],this.gridOptions=null,this.api=null,this._parse=b,this._getActualData=null,this._listenToEditEvents=!1}function j(a){return a}var k=a.lib,l=b.elements.AngularDataAwareController,m=b.mixins.DataElementMixIn,n=b.elements.BasicAngularElement,o=k.CBMapable;k.q;k.inherit(e,n),m.addMethods(e),e.prototype.__cleanUp=function(){this.afterEdit.destroy(),this.afterEdit=null,m.prototype.__cleanUp.call(this),n.prototype.__cleanUp.call(this)},e.prototype._replaceCellTemplate=function(a,b,c){a.cellTemplate&&"#"===a.cellTemplate.charAt(0)&&(a.cellTemplate=jQuery("#references > "+a.cellTemplate).html())},e.prototype.initialize=function(){n.prototype.initialize.call(this);var a=this.config.grid.enableCellEdit||k.traverseConditionally(this.getColumnDefs(),f),b=this.config.grid.enableColumnResizing||k.traverseConditionally(this.getColumnDefs(),g);this.getColumnDefs().forEach(this._replaceCellTemplate.bind(this));var c=$('<div class="table_container"></div>');c.attr("ui-grid","_ctrl.gridOptions"),c.attr("ui-grid-auto-resize",""),a&&c.attr("ui-grid-edit",""),b&&c.attr("ui-grid-resize-columns",""),c.addClass("grid"),this.$element.attr({"data-allex-angular-data-table":""}),this.$element.append(c);var d=this.findDomReference("actions");if(0!==d.length){var e=k.arryOperations.findElementWithProperty(this.config.grid.columnDefs,"field","-"),h={displayName:d.attr("data-title")||"Actions",cellTemplate:d.html()};e?(e.displayName||(e.displayName=h.displayName),e.cellTemplate||(e.cellTemplate=h.cellTemplate)):this.config.grid.columnDefs.unshift(k.extend({},h,{field:"-"}))}},e.prototype._onScope=function(a){var b={appendNewRow:this.appendNewRow.bind(this)};""===this.$element.find(".grid.table_container").attr("ui-grid-edit")&&(b.afterEdit=this.afterEdit.fire.bind(this.afterEdit)),a.set("_cbmap",b),a.set("gridOptions",this.config.grid)},e.prototype.set_data=function(a){var b=m.prototype.set_data.call(this,a);this.hasDataChanged(b)&&(this.$scopectrl.set("data",a),this.$scopectrl.api.core.refresh())},e.prototype.appendNewRow=function(a){var b={};this.getConfigVal("config.bSetNewRowProps");var c=this.getConfigVal("config.fAppendNewRow");return c?c(this,a,b):b},e.prototype.get_rows=function(){return this.$scopectrl.api?this.$scopectrl.api.grid.rows:null},e.prototype.getElement=function(a){return"$element"===a?this.$element:n.prototype.getElement.call(this,a)},e.prototype.set_row_count=function(a){return this.$scopectrl.set("row_count",a)},e.prototype.get_row_count=function(){return this.$scopectrl.get("row_count")},e.prototype.getColumnDefs=function(){return this.getConfigVal("grid.columnDefs")},e.prototype.$apply=function(){n.prototype.$apply.call(this),this.$scopectrl.api.core.refresh()},e.prototype.removeAllColumns=function(){this.config.grid.columnDefs.splice(0,this.config.grid.columnDefs.length),this.refreshGrid()},e.prototype.appendColumn=function(a){this.config.grid.columnDefs.push(a),this.refreshGrid()},e.prototype.set_column_defs=function(a){this.config.grid.columnDefs=a,this.refreshGrid()},e.prototype.get_column_defs=function(){return this.config.grid.columnDefs},e.prototype.refreshGrid=function(){this.$scopectrl.api.grid.refresh()},b.elements.AngularDataTable=e,c.registerElementType("AngularDataTable",e),b.ANGULAR_REQUIREMENTS.add("AngularDataTable",["ui.grid","ui.grid.edit","ui.grid.autoResize","ui.grid.resizeColumns"]),k.inherit(i,l),o.addMethods(i),i.prototype.__cleanUp=function(){this._getActualData=null,this._parse=null,this.rowCountChanged.destroy(),this.rowCountChanged=null,this.editDone=new k.HookCollection,this.gridOptions=null,this.data=null,this.api=null,o.prototype.__cleanUp.call(this),l.prototype.__cleanUp.call(this)},i.prototype.set_gridOptions=function(a){return this.gridOptions===a?!1:(this.api=null,this.gridOptions=a,this.gridOptions?(this.gridOptions.onRegisterApi=this.set.bind(this,"api"),void(k.isString(this.gridOptions.data)?this._getActualData=this._parse(this.gridOptions.data).bind(null,this.scope):this._getActualData=j.bind(null,this.gridOptions.data))):!0)},i.prototype.set_api=function(a){this.api!==a&&(this.api=a,this._cbmap&&this._cbmap.afterEdit&&this.api.edit.on.afterCellEdit(this.scope,this._onAfterEdit.bind(this)))},i.prototype._onAfterEdit=function(a,b,c,d){d!==c&&this.call_cb("afterEdit",[{newValue:c,oldValue:d,row:a,field:b.name}])},i.prototype.set_row_count=function(a){if(!this._getActualData)return!1;var b=this._getActualData();if(!k.isArray(b))return!1;var c=b.length,d=null;if(a===c)return!1;if(c>a)b.splice(a,c-a);else for(;b.length<a;)d=this.call_cb("appendNewRow",[b.length]),b.push(d);return!0},i.prototype.get_row_count=function(){if(!this._getActualData)return null;var a=this._getActualData();return k.isArray(a)?a.length:null},d.controller("allexAngularDataTableController",["$scope","$parse",function(a,b){new i(a,b)}]),d.directive("allexAngularDataTable",[function(){return{restrict:"A",scope:!0,controller:"allexAngularDataTableController",link:function(a,b,c){a._ctrl.elementReady(b)}}}])}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular.module("allex_applib")),function(a,b,c,d,e){"use strict";function f(a,b){h.call(this,g.extend({},a,{ispermanent:!0})),this._dependentElements=new g.Map,b.ready(this._onReady.bind(this))}var g=a.lib,h=c.BasicResourceLoader,i=g.q;g.inherit(f,h),f.prototype.__cleanUp=function(){this._dependentElements.destroy(),this._dependentElements=null,h.prototype.__cleanUp.call(this)},f.prototype.doLoad=function(){var a=i.defer();return a.resolve("ok"),a},f.prototype._onReady=function(a){var b=this.getConfigVal("angular_dependencies");b?(b.indexOf("allex_applib")<0&&b.push("allex_applib"),b.indexOf("allex__web_angularcomponent")<0&&b.push("allex__web_angularcomponent")):b=["allex_applib"],d.module("AllexActiveApp",b),d.module("AllexActiveApp").run(this._onModuleStarted.bind(this)),d.bootstrap(document,["AllexActiveApp"])},f.prototype._onModuleStarted=function(){var a=this.getConfigVal("onBootstrapped");g.isFunction(a)&&a(),a=window.AllexAngularBootstrapped,g.isFunction(a)&&a()},f.prototype.DEFAULT_CONFIG=function(){return{angular_dependencies:["allex_applib"]}},f.prototype.registerDependentElement=function(a){this._dependentElements.add(a.get("id"))},f.prototype.dependentElementReady=function(a){this._dependentElements.remove(a.get("id"))},b.resources.AngularBootstrapper=f,c.registerResourceType("AngularBootstrapper",f)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,angular,jQuery);