!function(allex,module,applib,vektr,$){"use strict";var lib=allex.lib,WebElement=module.elements.WebElement,BasicElement=applib.BasicElement,ctrl=vektr.ctrl,q=lib.q,CANVAS_SCHEMA={type:"object",properties:{svg:{type:"string"},autoresize:{type:"boolean"},debug:{type:"boolean"},ctor:{type:"string"},resources:WebElement.ResourcesSchema,klass:{type:"string"},elements:{type:"array"}},additionalProperties:!1,required:["debug","autoresize"]};function Integrator(e,t,n){ctrl.SVGInstantiator.call(this,e,t,n)}function VektrCanvas(e,t){WebElement.call(this,e,t),this.scene=null,this.renderer=null,this.vektrEvent=new lib.HookCollection,this.data=null}function _onVektrLoaded(e,t,n){if(!n)return t.reject(new Error("failed to load svg"));e.renderer=n,t.resolve(n)}lib.inherit(Integrator,ctrl.SVGInstantiator),Integrator.prototype.__cleanUp=function(){ctrl.SVGInstantiator.prototype.__cleanUp.call(this)},Integrator.prototype.runOn=function(e,t){t.isOldSchool()&&ctrl.SVGInstantiator.prototype.runOn.call(this,e)},lib.inherit(VektrCanvas,WebElement),VektrCanvas.prototype.__cleanUp=function(){this.vektrEvent.destroy(),this.vektrEvent=null,this.data=null,WebElement.prototype.__cleanUp.call(this)},VektrCanvas.prototype._loadSVG=function(e,t){var n=q.defer();return vektr.load(e,t,_onVektrLoaded.bind(null,this,n),this.loadEvent.fire.bind(this.loadEvent)),n.promise},VektrCanvas.prototype.load=function(){if(!this.getConfigVal("svg"))throw new Error("No svg given, can not move on ...");return WebElement.prototype.load.call(this)},VektrCanvas.prototype.onLoaded=function(){WebElement.prototype.onLoaded.call(this),this.scene=new vektr.compositing.Scene(this.get("id"),this.config);var svg=this.getConfigVal("svg"),pctor=this.getConfigVal("ctor"),ctor=pctor?eval(pctor):Integrator,p;return lib.isFunction(ctor)?(p=this._loadSVG(svg,ctor),p.then(this._runRenderers.bind(this))):q.reject(new Error("Failed to instantiate SVG, ctor is not a function"))},VektrCanvas.prototype.unload=function(){this.renderer&&this.renderer.destroy(),this.renderer=null,this.scene&&this.scene.destroy(),this.scene=null,this.$element.empty(),WebElement.prototype.unload.call(this)},VektrCanvas.prototype.sendCommand=function(e,t){if(this.renderer){if(!lib.isFunction(this.renderer.doExternalCommand))throw new Error("Renderer has no doExternalCommand method");return this.renderer.doExternalCommand(e,t)}console.warn("No renderer unable to send message")},VektrCanvas.prototype._runRenderers=function(){return this.renderer.runOn(this.get("id"),this),window.onresize(),q.resolve(!0)},VektrCanvas.prototype.CONFIG_SCHEMA=function(){return CANVAS_SCHEMA},VektrCanvas.prototype.DEFAULT_CONFIG=function(){return{debug:!0,autoresize:!0}},VektrCanvas.prototype.set_actual=function(e){WebElement.prototype.set_actual.call(this,e),window.onresize()},VektrCanvas.prototype.createElement=function(e){if(this.getConfigVal("ctor"))return BasicElement.prototype.createElement.call(this,e)},VektrCanvas.prototype.isOldSchool=function(){return!!this.getConfigVal("ctor")},VektrCanvas.prototype.dropCaches=function(){vektr.helpers.dropCaches()},module.elements.VektrCanvas=VektrCanvas,applib.registerElementType("VektrCanvas",VektrCanvas)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,vektr,jQuery);