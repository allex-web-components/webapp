!function(allex,module,applib,vektr,$){"use strict";function Integrator(a,b,c){ctrl.SVGInstantiator.call(this,a,b,c)}function VektrCanvas(a,b){WebElement.call(this,a,b),this.scene=null,this.renderers=null,this.vektrEvent=new lib.HookCollection,this.data=null}function _onVektrLoaded(a,b,c){return c?(a.renderers.push(c),void b.resolve(c)):b.reject(new Error("failed to load svg"))}var lib=allex.lib,WebElement=module.elements.WebElement,BasicElement=applib.BasicElement,ctrl=vektr.ctrl,q=lib.q,CANVAS_SCHEMA={type:"object",properties:{svg:{anyOf:[{type:"object",properties:{horizontal:{type:"string"},vertical:{type:"string"}},additionalProperties:!1,required:["horizontal"]},{type:"string"}]},autoresize:{type:"boolean"},debug:{type:"boolean"},mindOrientation:{type:"boolean"},ctor:{type:"string"},resources:WebElement.ResourcesSchema,klass:{type:"string"}},additionalProperties:!1,required:["debug","autoresize","mindOrientation","svg"]};lib.inherit(Integrator,ctrl.SVGInstantiator),Integrator.prototype.__cleanUp=function(){ctrl.SVGInstantiator.prototype.__cleanUp.call(this)},Integrator.prototype.runOn=function(a,b){b.isOldSchool()&&ctrl.SVGInstantiator.prototype.runOn.call(this,a)},lib.inherit(VektrCanvas,WebElement),VektrCanvas.prototype.__cleanUp=function(){this.vektrEvent.destroy(),this.vektrEvent=null,this.data=null,WebElement.prototype.__cleanUp.call(this)},VektrCanvas.prototype._loadSVG=function(a,b){var c=q.defer();return vektr.load(a,b,_onVektrLoaded.bind(null,this,c)),c.promise},VektrCanvas.prototype.load=function(){return WebElement.prototype.load.call(this).then(this._onLoaded.bind(this))},VektrCanvas.prototype._onLoaded=function(){this.scene=new vektr.compositing.Scene(this.get("id"),this.config);var svg=this.getConfigVal("svg"),pctor=this.getConfigVal("ctor"),ctor=pctor?eval(pctor):Integrator,p;return lib.isFunction(ctor)?(this.renderers=[],p=lib.isString(svg)?this._loadSVG(svg,ctor):q.all([this._loadSVG(svg.horizontal,ctor),this._loadSVG(svg.vertical,ctor)]),p.then(this._runRenderers.bind(this))):q.reject(new Error("Failed to instantiate SVG, ctor is not a function"))},VektrCanvas.prototype.unload=function(){this.$element.empty()},VektrCanvas.prototype._runRenderers=function(){return this.renderers.forEach(lib.doMethod.bind(null,"runOn",[this.get("id"),this])),q.resolve(!0)},VektrCanvas.prototype.CONFIG_SCHEMA=function(){return CANVAS_SCHEMA},VektrCanvas.prototype.DEFAULT_CONFIG=function(){return{debug:!0,autoresize:!0,mindOrientation:!1}},VektrCanvas.prototype.set_actual=function(a){WebElement.prototype.set_actual.call(this,a),window.onresize()},VektrCanvas.prototype.createElement=function(a){return this.getConfigVal("ctor")?BasicElement.prototype.createElement.call(this,a):void console.log("I ?!?!? Sta cemo sad?",a)},VektrCanvas.prototype.isOldSchool=function(){return!!this.getConfigVal("ctor")},module.elements.VektrCanvas=VektrCanvas,applib.registerElementType("VektrCanvas",VektrCanvas)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib,vektr,jQuery);