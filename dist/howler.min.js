!function(a,b,c){"use strict";function d(a){i.call(this,a),this.sounds=new h.Map}function e(a,b){return a+"/"+b}function f(a,b){return a.off("stop",b),a.off("end",b),h.q.resolve(!0)}function g(a,b){if(b&&!h.isString(b))throw new Error("Unable to play sound sprites upon something that is not a string: "+b);this.sound=a,this.sprite=b,this._cnt=null,this._onend=this._onEnd.bind(this),this.reps=null,this.defer=null}var h=a.lib,i=c.BasicResourceLoader,j={type:"object",properties:{sounds:{type:"array",items:{type:"object",properties:{name:{type:"string"},baseURL:{type:"string"},files:{type:"array",items:{type:"string"},volume:{type:"number",min:0,max:1},minItems:1},sprite:{type:"object"}},required:["files","name"]},minItems:1},baseURL:{type:"string"},volume:{type:"number"}},additionalProperties:!1};h.inherit(d,i),d.prototype.__cleanUp=function(){this.sounds.destroy(),this.sounds=null,i.prototype.__cleanUp.call(this)},d.prototype.load=function(){var a={baseURL:this.getConfigVal("baseURL"),volume:this.getConfigVal("volume")},b=h.q.all(this.getConfigVal("sounds").map(this._loadASound.bind(this,a)));return b.done(console.log.bind(console,"done"),console.log.bind(console,"failed")),b},d.prototype._loadASound=function(a,b){var c=h.q.defer(),d=h.extend({},a,b),f=new Howl({src:d.files.map(e.bind(null,d.baseURL)),autoplay:!1,volume:"volume"in d?d.volume:1,loop:!1,preload:!0,mute:!1,onload:c.resolve.bind(c,!0),onloaderror:this._failed.bind(this,c)});return this.sounds.add(d.name,f),c.promise},d.prototype._failed=function(a){console.log("failed to load",arguments),a.reject(new Error("failed"))},d.prototype.getSound=function(a){return this.sounds.get(a)},d.prototype.start=function(a,b){var c=this.getSound(a);if(!c)return d.reject(new Error("No sound "+a));var d=h.q.defer(),e=d.resolve.bind(d,!0);return c.on("stop",e),c.on("end",e),c.play(b),d.promise.then(f.bind(null,c,e))},d.prototype.muteAllSounds=Howler.mute.bind(Howler),d.prototype.CONFIG_SCHEMA=function(){return j},d.prototype.DEFAULT_CONFIG=function(){return null},d.prototype.loopSound=function(a,b){var c=this.getSound(a);if(!c)throw new Error("No sound registered: "+a);return new g(c,b)},g.prototype.destroy=function(){this.sound=null,this.sprite=null,this._cnt=null,this._onend=null,this.reps=null,this.defer=null},g.prototype.stop=function(){this.defer&&this.defer.resolve(!0),this.sound.off("end",this._onend),this.sound.stop(),this.reps=null},g.prototype.start=function(a,b){this.reps=h.isNumber(a)&&a>0?a:null,this.defer=b,this.sound.on("end",this._onend),this._onEnd()},g.prototype._onEnd=function(){this.sound.play(this.sprite),h.isNull(this.reps)||(this.reps--,this.reps||this.stop())},b.resources.HowlerResource=d,c.registerResourceType("Howler",d)}(ALLEX,ALLEX.WEB_COMPONENTS.allex_web_webappcomponent,ALLEX.WEB_COMPONENTS.allex_applib);